#!/bin/bash

yes | apt-get install tmux
yes | apt-get install zsh
wget https://www.dropbox.com/s/wqn5v3wkktw9lmo/install.sh?dl=0 -O install.sh
sudo sh install.sh

pip3 install -U pip
pip3 install tensorflow-gpu
pip3 install -r <(grep -v tensorflow requirements.txt)

# Install ds_ctcdecoder package from TaskCluster
pip3 install $(python3 util/taskcluster.py --decoder)

mkdir -p ../keep/summaries

export data="${SHARED_DIR}/data"
export fis="${data}/LDC/fisher"
export swb="${data}/LDC/LDC97S62/swb"
export lbs="${data}/OpenSLR/LibriSpeech/librivox"

python3 -u DeepSpeechTF2.py \
  --train_files "${fis}-train.csv","${swb}-train.csv","${lbs}-train-clean-100.csv","${lbs}-train-clean-360.csv","${lbs}-train-other-500.csv" \
  --dev_files "${lbs}-dev-clean.csv"\
  --test_files "${lbs}-test-clean.csv" \
  --train_batch_size 24 \
  --dev_batch_size 48 \
  --test_batch_size 48 \
  --n_hidden 2048 \
  --learning_rate 0.0001 \
  --dropout_rate 0.2 \
  --epochs 13 \
  --checkpoint_dir "../keep" \
  --summary_dir "../keep/summaries"

while true; do sleep 1000000; done

